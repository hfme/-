# JS 运行机制



## 进程与线程

 进程是CPU分配资源的最小单位，一个进程由一个或多个线程组成

线程是程序执行的最小单位



进程之间相互独立运行互不干扰，比如听音乐和浏览器阅读互不干扰



拿浏览器来说，浏览器是多进程的，比如第三方插件进程、渲染进程（每个tab页都有一个单独的进程，进程里又是多线程的）







## JS 为什么是单线程

JS是一门浏览器脚本语言，主要负责与用户交互和操作DOM，这就决定了JS必须是单线程语言，如果是多线程，那么当线程之间操作冲突的时候就无法处理了





## 浏览器

浏览器是多进程的，比如chrome浏览器就包含以下进程：

- Broswer 进程
  - 浏览器主进程，负责协调、主控
  - 负责浏览器界面显示，与用户交互
  - 负责各个页面的管理，创建和销毁其他进程
  - 网络资源的管理和下载等
- 第三方插件进程
- GPU进程
  - 只有一个
  - 用于3D绘制等
- **渲染进程**
  - renderer 进程
  - 每个tab页面都有一个渲染进程，互不影响
  - 主要作用是为页面渲染，脚本执行，事件处理等

<img src="/Users/neofei/Fei/Frontend/笔记/images/image-20210805123809349.png" alt="image-20210805123809349" style="zoom: 33%;" />





### 浏览器的渲染进程

渲染进程的主要线程：

- GUI 渲染
- JS 引擎线程
  - 负责处理JS脚本程序
  - 比如 V8引擎
  - GUI渲染线程和JS引擎线程是互斥的
- 事件触发线程
- 定时器触发线程
- 异步 http 请求线程
  - 在XMLHttpRequest连接后是通过浏览器新开一个线程请求
  - 线程监测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中再由JS引擎执行
  - 简单说就是当执行到一个http异步请求时，就把异步请求事件添加到异步请求线程，等收到响应(准确来说应该是http状态变化)，再把回调函数添加到事件队列，等待js引擎线程来执行









## 事件循环







## Promise





## async.await











https://juejin.cn/post/6844904050543034376#heading-0

